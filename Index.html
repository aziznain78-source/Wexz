<!DOCTYPE html>
<html lang="id">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>WEXZ - Mini Social Media</title>
<style>
*{box-sizing:border-box}
body{margin:0;font-family:Arial;background:#fff;color:#000}
header{position:fixed;top:0;left:0;right:0;height:55px;background:#000;color:#fff;display:flex;align-items:center;justify-content:space-between;padding:0 10px;z-index:10}
header .left{font-size:22px;cursor:pointer}
header img{width:32px;height:32px;border-radius:50%}
#feed{margin-top:60px;margin-bottom:70px;padding:10px}
.post{border:1px solid #ccc;border-radius:10px;margin-bottom:15px;overflow:hidden}
.post img,.post video{width:100%;max-height:350px;object-fit:cover}
.actions{display:flex;justify-content:space-around;padding:6px;gap:6px}
.actions button{border:none;background:#000;color:#fff;padding:6px 10px;border-radius:6px}
footer{position:fixed;bottom:0;left:0;right:0;height:60px;background:#000;display:flex}
footer button{flex:1;background:none;border:none;color:white;font-size:16px}
#loginBox{position:fixed;top:0;left:0;right:0;bottom:0;background:#000;color:#fff;display:flex;flex-direction:column;align-items:center;justify-content:center}
#loginBox input,#loginBox button{width:80%;padding:10px;margin:6px;border-radius:8px;border:none}
#notif{position:fixed;top:60px;left:10px;right:10px;background:#000;color:#fff;padding:10px;border-radius:10px;display:none;z-index:20}
#adminPanel{position:fixed;bottom:70px;left:10px;right:10px;background:#000;color:#fff;padding:10px;border-radius:12px;display:none}
#adminPanel input,#adminPanel button{width:100%;padding:8px;margin:4px;border-radius:8px;border:none}
</style>
</head>
<body>

<header>
  <div class="left" onclick="logout()">‚éã</div>
  <div>WEXZ</div>
  <div class="right">
    <span id="userName"></span>
    <img src="https://i.imgur.com/6VBx3io.png">
  </div>
</header>

<div id="notif"></div>
<div id="feed"></div>

<footer>
  <button onclick="uploadPhoto()">üì∑</button>
  <button onclick="uploadVideo()">üé•</button>
  <button onclick="toggleAdmin()">‚ö°</button>
</footer>

<div id="loginBox">
  <h2>Login / Daftar WEXZ</h2>
  <input id="user" placeholder="Username">
  <input id="pass" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <button onclick="register()">Daftar</button>
</div>

<div id="adminPanel">
  <b>ADMIN COMBO PANEL</b>
  <input id="targetUser" placeholder="Target username">
  <input id="loveAmount" type="number" placeholder="Tambah love berapa">
  <button onclick="boostLove()">Tambah Love</button>
  <button onclick="resetBan()">Reset BAN user</button>
</div>

<script>
const ADMIN_USER="wexzadmin";
const ADMIN_PASS="1234@dzul@nain";

let users=JSON.parse(localStorage.getItem("users")||"[]");
let posts=JSON.parse(localStorage.getItem("posts")||"[]");
let follows=JSON.parse(localStorage.getItem("follows")||"{}");
let notifs=JSON.parse(localStorage.getItem("notifs")||"{}");
let bans=JSON.parse(localStorage.getItem("bans")||"{}");
let badCount=JSON.parse(localStorage.getItem("badCount")||"{}");

let badWords=["anjing","bangsat","kontol","memek","fuck","shit","babi","asu","tolol"];

let currentUser=localStorage.getItem("currentUser");
const feed=document.getElementById("feed");
const loginBox=document.getElementById("loginBox");
const userName=document.getElementById("userName");
const notifBox=document.getElementById("notif");
const adminPanel=document.getElementById("adminPanel");

if(!users.find(u=>u.u===ADMIN_USER)){
  users.push({u:ADMIN_USER,p:ADMIN_PASS,admin:true});
  localStorage.setItem("users",JSON.stringify(users));
}

if(currentUser){
  if(isBanned(currentUser) && currentUser!==ADMIN_USER){
    alert("Akun kamu sedang di BAN!");
    logout();
  }
  loginBox.style.display="none";
  userName.innerText=currentUser+(isAdmin()?" üëë":"");
  showNotif();
  renderFeed();
}

function isAdmin(){return currentUser===ADMIN_USER}

function toggleAdmin(){
  if(isAdmin()) adminPanel.style.display=adminPanel.style.display==="none"?"block":"none";
}

function register(){
  let u=user.value.trim(),p=pass.value.trim();
  if(!u||!p) return alert("Isi semua!");
  if(p.length<6) return alert("Password min 6 karakter");
  if(users.find(x=>x.u===u)) return alert("Akun sudah ada");
  users.push({u,p});
  localStorage.setItem("users",JSON.stringify(users));
  alert("Akun dibuat!");
}

function login(){
  let u=user.value.trim(),p=pass.value.trim();
  let f=users.find(x=>x.u===u && x.p===p);
  if(!f) return alert("Login gagal");
  if(isBanned(u) && u!==ADMIN_USER) return alert("Akun sedang dibanned!");
  localStorage.setItem("currentUser",u);
  location.reload();
}

function logout(){localStorage.removeItem("currentUser");location.reload();}

function uploadPhoto(){pickFile("image/*","image")}
function uploadVideo(){pickFile("video/*","video")}

function pickFile(type,kind){
  if(isBanned(currentUser) && !isAdmin()) return alert("Kamu sedang di BAN!");
  let input=document.createElement("input");
  input.type="file";input.accept=type;
  input.onchange=e=>savePost(e.target.files[0],kind);
  input.click();
}

function savePost(file,type){
  let reader=new FileReader();
  reader.onload=()=>{
    let post={user:currentUser,type,data:reader.result,like:0,dislike:0};
    posts.unshift(post);
    localStorage.setItem("posts",JSON.stringify(posts));
    notifyFollowers(currentUser);
    renderFeed();
  }
  reader.readAsDataURL(file);
}

function renderFeed(){
  feed.innerHTML="";
  posts.forEach((p,i)=>{
    let isFollowing=(follows[currentUser]||[]).includes(p.user);
    let div=document.createElement("div");
    div.className="post";
    div.innerHTML=`
      ${p.type==="image"?`<img src='${p.data}'>`:`<video src='${p.data}' controls></video>`}
      <div style='padding:6px'><b>@${p.user}</b>
        ${p.user!==currentUser?`<button onclick="toggleFollow('${p.user}')" style="float:right">${isFollowing?"Unfollow":"Follow"}</button>`:""}
      </div>
      <div class='actions'>
        <button onclick='like(${i})'>‚ù§Ô∏è ${p.like}</button>
        <button onclick='dislike(${i})'>üíî ${p.dislike}</button>
      </div>
    `;
    feed.appendChild(div);
  });
}

function like(i){posts[i].like++;save()}
function dislike(i){posts[i].dislike++;save()}
function save(){localStorage.setItem("posts",JSON.stringify(posts));renderFeed()}

/* FOLLOW + NOTIF */
function toggleFollow(user){
  follows[currentUser]=follows[currentUser]||[];
  if(follows[currentUser].includes(user)){
    follows[currentUser]=follows[currentUser].filter(x=>x!==user);
  }else{
    follows[currentUser].push(user);
  }
  localStorage.setItem("follows",JSON.stringify(follows));
  renderFeed();
}
function notifyFollowers(u){
  Object.keys(follows).forEach(f=>{
    if((follows[f]||[]).includes(u)){
      notifs[f]=`@${u} upload baru!`;
    }
  });
  localStorage.setItem("notifs",JSON.stringify(notifs));
}
function showNotif(){
  if(notifs[currentUser]){
    notifBox.style.display="block";
    notifBox.innerText=notifs[currentUser];
    setTimeout(()=>notifBox.style.display="none",4000);
    delete notifs[currentUser];
    localStorage.setItem("notifs",JSON.stringify(notifs));
  }
}

/* SENSOR + BAN */
function checkBadWords(text){
  let c=0;badWords.forEach(w=>{let m=text.match(new RegExp(w,"gi"));if(m)c+=m.length});return c;
}
function addViolation(user,count){
  badCount[user]=(badCount[user]||0)+count;
  localStorage.setItem("badCount",JSON.stringify(badCount));
  if(badCount[user]>=4 && user!==ADMIN_USER){
    let m=count; bans[user]=Date.now()+m*60000;
    localStorage.setItem("bans",JSON.stringify(bans));
  }
}
function isBanned(user){
  if(!bans[user]) return false;
  if(Date.now()>bans[user]){delete bans[user];localStorage.setItem("bans",JSON.stringify(bans));return false;}
  return true;
}

/* ADMIN COMBO */
function boostLove(){
  if(!isAdmin())return;
  let t=targetUser.value;
  let n=parseInt(loveAmount.value||0);
  posts.forEach(p=>{if(p.user===t)p.like+=n});
  save();
}
function resetBan(){
  if(!isAdmin())return;
  let t=targetUser.value;
  delete bans[t]; delete badCount[t];
  localStorage.setItem("bans",JSON.stringify(bans));
  localStorage.setItem("badCount",JSON.stringify(badCount));
  alert("BAN direset");
}
</script>
</body>
</html>